- defaults:
    name: python_tests
    project-type: 'freestyle'
    defaults: global
    description: 'Flake8 Check Python Code'
    concurrent: true
    quiet-period: 5
    properties:
        - github_project_url:
            projectUrl: '{git_url}'
    scm:
        - git:
            url: '{git_repo}'
            credentials-id: !include /etc/jenkins_jobs/github-creds.txt
            basedir: 'code'
            git-config-name: 'Jenkins (Britt Gresham)'
            git-config-email: 'jenkins@brittg.com'

- builder:
    name: flake8_test
    builders:
        - shell: |
            rm -rf ./flake8
            virtualenv flake8
            . ./flake8/bin/activate

            which python
            which pip

            pip install flake8

            cd ./code
            if [ -e "tox.ini" ]
            then
                flake8 --config=tox.ini ./
            else
                flake8 --ignore=E501,E731,W0621,F812 --max-line-length=140 ./
            fi

- job-template:
    name: '{name}-Flake8-Master'
    display-name: '{name} Flake8 Test (Master)'
    defaults: python_tests
    builders:
        - flake8_test:

- job-template:
    name: '{name}-Flake8-Pull-Request'
    display-name: '{name} Flake8 Test (PR)'
    defaults: python_tests
    builders:
        - github_pending_status:
        - flake8_test:
    publishers:
        - github_status_on_failure:

- job-group:
    name: '{name}-tests'
    jobs:
        - '{name}-Flake8-Master':
            triggers:
                - github
            scm:
                - git:
                    local-branch: 'master'
        - '{name}-Flake8-Pull-Request':
            triggers:
                - github-pull-request:
                    admin-list:
                        - demophoon
                    permit-all: true

- project:
    name: 'Webvim'
    git_repo: 'git@github.com:demophoon/webvim.git'
    git_url: 'https://github.com/demophoon/webvim'
    jobs:
        - '{name}-tests'

- project:
    name: 'Brittbot'
    git_repo: 'git@github.com:demophoon/brittbot.git'
    git_url: 'https://github.com/demophoon/brittbot'
    jobs:
        - '{name}-tests'

- project:
    name: 'FOSS-Sams'
    git_repo: 'git@github.com:demophoon/sams.git'
    git_url: 'https://github.com/demophoon/sams'
    jobs:
        - '{name}-tests'

- project:
    name: 'Cards-of-Lunacy'
    git_repo: 'git@github.com:demophoon/cards-of-lunacy.git'
    git_url: 'https://github.com/demophoon/cards-of-lunacy'
    jobs:
        - '{name}-tests'

- project:
    name: 'PingdomLib'
    git_repo: 'git@github.com:demophoon/PingdomLib.git'
    git_url: 'https://github.com/demophoon/PingdomLib'
    disabled: true

- project:
    name: 'Vundle-Headless-Installer'
    git_repo: 'git@github.com:demophoon/vundle-headless-installer.git'
    git_url: 'https://github.com/demophoon/vundle-headless-installer'
    jobs:
        - '{name}-tests'
