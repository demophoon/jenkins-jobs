- scm:
    name: demophoon.github.io
    scm:
        - git:
            url: 'git@github.com:demophoon/demophoon.github.io.git'
            branches:
                - 'origin/staging'
            local-branch: 'staging'
            credentials-id: !include github-creds.txt
            git-config-name: 'Jenkins (Britt Gresham)'
            git-config-email: 'jenkins@brittg.com'

- job:
    name: publish-blog
    project-type: freestyle
    defaults: global
    description: 'Do not edit this job through the web!'
    disabled: false
    display-name: 'Publish Blog'
    concurrent: true
    quiet-period: 30
    logrotate:
        daysToKeep: -1
        numToKeep: 30
        artifactDaysToKeep: -1
        artifactNumToKeep: 30
    scm:
        - demophoon.github.io
    builders:
        - shell: |
            virtualenv publish-blog
            . ./publish-blog/bin/activate

            which python
            which pip

            python setup.py develop
            pelican content -o output -s publishconf.py
            ghp-import output
            git checkout master
            git merge gh-pages -m "Built by Jenkins ${JOB_NAME} #${BUILD_NUMBER}"
    publishers:
        - git_publisher:
            pushMerge: true
            pushOnlyIfSuccess: true
            branch: 'master'
            remote: 'origin'
        - ircbot:
            strategy: all
            notify-start: false
            notify-committers: false
            notify-culprits: false
            notify-upstream: false
            notify-fixers: false
            message-type: 'summary'
            channels:
                - name: '##brittslittlesliceofheaven'
                  notify-only: false
